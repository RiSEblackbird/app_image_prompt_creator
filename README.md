# 画像プロンプトランダム生成ツール

![image](https://github.com/user-attachments/assets/ab9d4136-7a42-4a38-83fa-436622a536b2)

## 概要
このアプリケーションは、Midjourney向けの画像生成プロンプトをランダムに生成するためのツールです。データベースに登録された属性や特徴を組み合わせて、多様な画像プロンプトを作成することができます。

## 主な機能
- 属性ベースのプロンプト生成
- プロンプトのランダム組み合わせ
- Midjourneyオプションの付与（--ar, --s, --chaos, --q, --weird）
- 除外語句の設定
- CSVデータのインポート/エクスポート
- クリップボードへのコピー機能
- アレンジ（LLM）機能：プリセット（世界観/画風）＋強度スライダーで英語プロンプトを“味変”
- アレンジプリセットの外部YAML管理（`arrange_presets.yaml`）

## 技術仕様
- 開発言語: Python
- GUIフレームワーク: tkinter
- データベース: SQLite3
- 設定ファイル: YAML

## 使用方法
1. 属性タイプの選択
   - 各属性タイプのプルダウンから特徴を選択する
   - 選択した特徴の使用回数を0-10の範囲で指定する
   - 複数の属性タイプを組み合わせることができる

2. 生成設定の調整
   - 生成する行数を数値で入力する
   - 自動反映のチェックボックスをオンにすると、設定変更時に自動で更新される

3. オプションの設定
   - 末尾固定文：定型文を選択または入力する
   - アスペクト比(--ar)：16:9、9:16などを選択する
   - スタイライズ(--s)：0-1000の範囲で選択する
   - カオス度(--chaos)：0-100の範囲で選択する
   - クオリティ(--q)：1-2の範囲で選択する
   - 特異度(--weird)：0-3000の範囲で選択する

4. 除外語句の設定
   - カンマ区切りで複数の除外語句を入力する
   - 「除外語句CSVを開く」で過去の設定を確認・編集できる

5. プロンプト生成とコピー
   - 「生成」ボタンでプロンプトを生成する
   - 「生成とコピー（全文）」で生成と同時にクリップボードにコピーする
   - 「クリップボードにコピー(全文)」で生成済みのプロンプトをコピーする
   - 「クリップボードにコピー(options)」でオプション部分のみをコピーする

6. アレンジ（LLM）
   - 右ペインのプリセット（例：ファンタジー／サイバーパンク／和風／浮世絵／スチームパンク 等）を選ぶ
   - 強度スライダー（0-3）を調整（スライダー上に0.3秒ホバーで日本語ツールチップが表示）
   - 「アレンジ(LLM)」で出力欄が英語の味変プロンプトに更新
   - 「アレンジしてコピー(LLM)」で更新→全文コピー

## 機能詳細
### プロンプト生成機能
- 属性ベースの生成
  - データベースに登録された属性から特徴を選択する
  - 各特徴の使用回数を個別に指定する
  - 選択した特徴の組み合わせからランダムに生成する
  - 指定した行数分のプロンプトを生成する

- 文章の自動整形
  - 各プロンプトの末尾にピリオドを自動付与する
  - カンマやセミコロンなどの区切り文字を適切に処理する
  - 生成されたプロンプトをランダムに並び替える

### Midjourneyオプション機能
- アスペクト比(--ar)
  - 16:9、9:16、4:3、3:4から選択する
  - 画像の縦横比を指定する

- スタイライズ(--s)
  - 0-1000の範囲で選択する
  - スタイルの強さを調整する

- カオス度(--chaos)
  - 0-100の範囲で選択する
  - バリエーションの多様性を制御する

- クオリティ(--q)
  - 1-2の範囲で選択する
  - 生成画像の品質を指定する

- 特異度(--weird)
  - 0-3000の範囲で選択する
  - 生成結果の特異性を調整する

### データ管理機能
- CSVインポート
  - 「CSVをDBに投入」ボタンでインポートウィンドウを開く
  - テキストエリアにCSVデータを貼り付ける
  - 「投入」ボタンでデータベースに登録する

- CSVエクスポート
  - 「(DB確認用CSV出力)」ボタンでデータをエクスポートする
  - 現在のデータベース内容を確認できる

- 除外語句管理
  - CSVファイルで除外語句を管理する
  - 新規の除外語句は自動的にCSVに追加される
  - 過去の除外語句をプルダウンから選択できる

### アレンジ機能（LLM）
- プリセット
  - `app_image_prompt_creator/arrange_presets.yaml`から読み込み
  - 世界観/画風のガイダンスをLLMに渡して、英語で味変（例：ファンタジー、サイバーパンク、和風、浮世絵、ゴシック、アール・デコ、アール・ヌーヴォー、アニメ、漫画、水彩画、ノワール、ヴェイパーウェーブ、パステル 等）
- 強度スライダー（0-3）
  - 0: 極めて穏やかな味変（ニュアンス）
  - 1: 穏やか（軽い言い換え／少量追記）
  - 2: 中程度（明確なスタイル付与）
  - 3: 強い（大胆な言い換え・世界観の強調）
  - スライダーに0.3秒ホバーで説明ツールチップを表示
- 英語出力ポリシー
  - LLMへの指示で「英語のみ」を強制
  - 非英語が混ざった場合は代表語を英訳へ置換するサニタイズを実施
- バリエーションの担保
  - 同一出力を避けるため、内部でノンス（乱数）と直前出力（PreviousOutput）を付与
  - 同一出力の場合は自動で1回再試行

## 設定
- 設定ファイル: `desktop_gui_settings.yaml`（例は `desktop_gui_settings.yaml.example` を参照）
- 本アプリで使用する主なキー
  - `POSITION_FILE`: ウィンドウ位置記録（互換目的）
  - `BASE_FOLDER`: 本アプリのベースフォルダ
  - `DEFAULT_TXT_PATH`: プロンプト部品テキスト
  - `DEFAULT_DB_PATH`: SQLite3 DBパス
  - `EXCLUSION_CSV`: 除外語句CSV
  - `ARRANGE_PRESETS_YAML`: アレンジプリセットYAML
  - `LLM_ENABLED`: LLMアレンジの有効/無効
  - `LLM_MODEL`: 例 `gpt-5-mini`（環境で利用可能なモデル名を指定）
  - `LLM_MAX_COMPLETION_TOKENS`: LLM応答の最大トークン
  - `LLM_TIMEOUT`: 呼び出しのタイムアウト秒
  - `OPENAI_API_KEY_ENV`: APIキーを格納する環境変数名（例 `OPENAI_API_KEY`）
  - `LLM_INCLUDE_TEMPERATURE`: temperatureを送るか（多くのモデルで既定=1のみ。通常はfalse推奨）
  - `LLM_TEMPERATURE`: 送る場合の温度値（既定は1）

### 環境変数（例：Windows PowerShell）
```powershell
setx OPENAI_API_KEY "sk-xxxxx"
```

### UI機能
- 自動反映設定
  - チェックボックスをオンにすると設定変更時に自動更新する
  - オフの場合は手動で更新ボタンを押す必要がある

- 更新機能
  - 「末尾固定部のみ更新」で固定文のみを更新する
  - 「オプションのみ更新」でMidjourneyオプションのみを更新する

- ウィンドウ位置
  - 前回終了時のウィンドウ位置を記憶する
  - 次回起動時に同じ位置で表示する

## 注意点
- データベースの書き込み権限が必要です
- CSVインポート時は正しいフォーマットが必要です
- 除外語句は複数指定可能です（カンマ区切り）
- 生成されたプロンプトは自動的にピリオドで終了します
- オプション値は事前に定義された範囲内で選択可能です
